<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-4 sm:py-6 lg:py-8">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-6 sm:mb-8">
      <a
        routerLink="/reminders"
        class="text-blue-600 hover:text-blue-700 dark:hover:text-blue-400 font-medium mb-3 sm:mb-4 inline-flex items-center text-sm sm:text-base"
      >
        <span class="material-symbols-rounded text-xl sm:text-2xl mr-1">arrow_back</span>
        <span class="hidden xs:inline">{{ 'form.back' | translate }}</span>
        <span class="xs:hidden">{{ 'form.backShort' | translate }}</span>
      </a>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100 flex items-center flex-wrap gap-2">
        <span class="material-symbols-rounded text-2xl sm:text-3xl">{{
          isEditMode() ? 'edit' : 'add'
        }}</span>
        <span>{{ isEditMode() ? ('form.editReminder' | translate) : ('form.newReminder' | translate) }}</span>
      </h1>
      <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 mt-2">
        {{
          isEditMode()
            ? ('form.editSubtitle' | translate)
            : ('form.newSubtitle' | translate)
        }}
      </p>
    </div>

    <!-- Form -->
    <form (ngSubmit)="save()" class="space-y-4 sm:space-y-6">
      <!-- Título -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
        <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Título <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="title"
          [ngModel]="title()"
          name="title"
          (ngModelChange)="title.set($event)"
          required
          maxlength="100"
          class="w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="Ej: Comprar leche"
        />
      </div>

      <!-- Descripción -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
        <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Descripción <span class="text-red-500">*</span>
        </label>
        <textarea
          id="description"
          [ngModel]="description()"
          name="description"
          (ngModelChange)="description.set($event)"
          required
          rows="4"
          maxlength="500"
          class="w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
          placeholder="Describe tu recordatorio..."
        ></textarea>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ description().length }}/500 caracteres</p>
      </div>

      <!-- Categoría -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
        <fieldset aria-labelledby="category-legend" class="border-0 p-0 m-0">
          <legend id="category-legend" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 sm:mb-4">
            Categoría <span class="text-red-500">*</span>
          </legend>
          <div class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3">
            @for (cat of categories(); track cat.slug) {
              <button
                type="button"
                (click)="updateCategory(cat.slug)"
                [class]="
                  categorySlug() === cat.slug
                    ? cat.color + ' text-white border-transparent'
                    : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500'
                "
                class="flex items-center justify-center gap-2 p-3 sm:p-4 border-2 rounded-lg transition-all cursor-pointer min-h-[44px]"
                title="Seleccionar {{ cat.name }}"
              >
                <span class="w-2 h-2 rounded-full flex-shrink-0" [class]="cat.color"></span>
                <span class="material-symbols-rounded text-xl sm:text-2xl flex-shrink-0">{{
                  cat.icon || 'label' | iconName
                }}</span>
                <span class="text-xs sm:text-sm font-medium truncate">{{ cat.name }}</span>
              </button>
            }
          </div>
        </fieldset>
      </div>

      <!-- Ubicación -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
        <h3 class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 sm:mb-4">
          {{ 'form.location' | translate }} <span class="text-red-500">*</span>
        </h3>

        @if (location()) {
          <div class="mb-4 p-3 sm:p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
            <div class="flex items-start gap-3">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-1 flex items-center gap-1">
                  <span class="material-symbols-rounded text-base sm:text-lg flex-shrink-0"
                    >location_on</span
                  >
                  <span class="truncate">{{ locationName() }}</span>
                </p>
                <p class="text-xs text-gray-600 dark:text-gray-400 break-words">{{ locationAddress() }}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 break-all">
                  @if (location()) {
                    Lat: {{ location()!.latitude.toFixed(6) }}, Lng:
                    {{ location()!.longitude.toFixed(6) }}
                  }
                </p>
              </div>
              <button
                type="button"
                (click)="location.set(null)"
                class="text-red-600 hover:text-red-700 text-xs sm:text-sm font-medium flex-shrink-0 px-2 py-1"
              >
                Cambiar
              </button>
            </div>
          </div>
        } @else {
          <div class="mb-4 p-3 sm:p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
            <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-300">
              {{ 'form.noLocation' | translate }}
            </p>
          </div>
        }

        <div class="flex flex-col xs:flex-row gap-2 sm:gap-3">
          <button
            type="button"
            (click)="useCurrentLocation()"
            [disabled]="isLoadingLocation()"
            class="flex-1 px-3 sm:px-4 py-2.5 sm:py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors font-medium text-sm sm:text-base min-h-[44px] flex items-center justify-center gap-1 sm:gap-2"
          >
            @if (isLoadingLocation()) {
              <span class="material-symbols-rounded text-lg sm:text-xl">refresh</span>
              <span class="hidden xs:inline">Obteniendo ubicación...</span>
              <span class="xs:hidden">Obteniendo...</span>
            } @else {
              <span class="material-symbols-rounded text-lg sm:text-xl">location_on</span>
              <span class="hidden xs:inline">Usar ubicación actual</span>
              <span class="xs:hidden">Ubicación actual</span>
            }
          </button>

          <button
            type="button"
            (click)="openMapPicker()"
            class="flex-1 px-3 sm:px-4 py-2.5 sm:py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm sm:text-base min-h-[44px] flex items-center justify-center gap-1 sm:gap-2"
          >
            <span class="material-symbols-rounded text-lg sm:text-xl">map</span>
            <span class="hidden xs:inline">{{ 'form.selectOnMap' | translate }}</span>
            <span class="xs:hidden">{{ 'form.mapShort' | translate }}</span>
          </button>

          <button
            type="button"
            (click)="setManualLocation()"
            class="flex-1 px-3 sm:px-4 py-2.5 sm:py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium text-sm sm:text-base min-h-[44px] flex items-center justify-center gap-1 sm:gap-2"
          >
            <span class="material-symbols-rounded text-lg sm:text-xl">keyboard</span>
            <span class="hidden xs:inline">{{ 'form.enterCoords' | translate }}</span>
            <span class="xs:hidden">{{ 'form.coordsShort' | translate }}</span>
          </button>
        </div>

        <!-- Nombre y dirección de la ubicación -->
        @if (location()) {
          <div class="mt-4 space-y-3">
            <div>
              <label for="locationName" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                {{ 'form.locationName' | translate }} <span class="text-gray-500 dark:text-gray-400 text-xs">({{ 'form.optional' | translate }})</span>
              </label>
              <input
                type="text"
                id="locationName"
                [ngModel]="locationName()"
                name="locationName"
                (ngModelChange)="locationName.set($event)"
                maxlength="100"
                class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                [placeholder]="'form.locationNamePlaceholder' | translate"
              />
            </div>
            <div>
              <label for="locationAddress" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                {{ 'form.locationAddress' | translate }} <span class="text-gray-500 dark:text-gray-400 text-xs">({{ 'form.optional' | translate }})</span>
              </label>
              <input
                type="text"
                id="locationAddress"
                [ngModel]="locationAddress()"
                name="locationAddress"
                (ngModelChange)="locationAddress.set($event)"
                maxlength="200"
                class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                [placeholder]="'form.addressPlaceholder' | translate"
              />
            </div>
          </div>
        }
      </div>

      <!-- Tipo de Activación -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 sm:mb-4">
          Tipo de Activación <span class="text-red-500">*</span>
        </label>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <button
            type="button"
            (click)="updateActivationType('location')"
            [class]="
              activationType() === 'location'
                ? 'bg-blue-600 text-white border-blue-600'
                : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:border-blue-400'
            "
            class="flex flex-col items-center gap-2 p-4 border-2 rounded-lg transition-all cursor-pointer min-h-[100px] justify-center"
          >
            <span class="material-symbols-rounded text-3xl">location_on</span>
            <span class="text-sm font-medium">Por Ubicación</span>
            <span class="text-xs opacity-80 text-center">Al acercarte al lugar</span>
          </button>
          <button
            type="button"
            (click)="updateActivationType('time')"
            [class]="
              activationType() === 'time'
                ? 'bg-purple-600 text-white border-purple-600'
                : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:border-purple-400'
            "
            class="flex flex-col items-center gap-2 p-4 border-2 rounded-lg transition-all cursor-pointer min-h-[100px] justify-center"
          >
            <span class="material-symbols-rounded text-3xl">schedule</span>
            <span class="text-sm font-medium">Por Fecha/Hora</span>
            <span class="text-xs opacity-80 text-center">En momento específico</span>
          </button>
          <button
            type="button"
            (click)="updateActivationType('both')"
            [class]="
              activationType() === 'both'
                ? 'bg-green-600 text-white border-green-600'
                : 'bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 hover:border-green-400'
            "
            class="flex flex-col items-center gap-2 p-4 border-2 rounded-lg transition-all cursor-pointer min-h-[100px] justify-center"
          >
            <span class="material-symbols-rounded text-3xl">hub</span>
            <span class="text-sm font-medium">Ambos</span>
            <span class="text-xs opacity-80 text-center">Ubicación + Tiempo</span>
          </button>
        </div>
      </div>

      <!-- Fecha y Hora Programada (solo si activationType es 'time' o 'both') -->
      @if (activationType() === 'time' || activationType() === 'both') {
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
          <label for="scheduledTime" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
            Fecha y Hora de Activación <span class="text-red-500">*</span>
          </label>
          <input
            type="datetime-local"
            id="scheduledTime"
            [ngModel]="scheduledTime()"
            name="scheduledTime"
            (ngModelChange)="scheduledTime.set($event)"
            [min]="getMinDateTime()"
            class="w-full px-3 sm:px-4 py-2 sm:py-2.5 text-sm sm:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
          />
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
            @if (scheduledTime()) {
              Se activará el {{ formatScheduledTime() }}
            } @else {
              Selecciona cuándo quieres que se active este recordatorio
            }
          </p>
        </div>
      }

      <!-- Radio de notificación (solo si activationType es 'location' o 'both') -->
      @if (activationType() === 'location' || activationType() === 'both') {
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-4 sm:p-6">
          <label for="radius" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 sm:mb-4">
            Radio de notificación: <span class="text-blue-600 font-semibold">{{ radius() }}m</span>
          </label>

          <div class="grid grid-cols-2 xs:grid-cols-3 sm:grid-cols-6 gap-2 mb-4">
            @for (opt of radiusOptions; track opt.value) {
              <button
                type="button"
                (click)="updateRadius(opt.value)"
                [class]="
                  radius() === opt.value
                    ? 'bg-blue-600 text-white'
                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                "
                class="px-2 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors min-h-[44px]"
              >
                {{ opt.label }}
              </button>
            }
          </div>

          <input
            type="range"
            id="radius"
            [ngModel]="radius()"
            name="radius"
            (ngModelChange)="radius.set($event)"
            min="50"
            max="5000"
            step="50"
            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
          />

          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
            {{ 'form.radiusHelp' | translate:{ value: radius() } }}
          </p>
        </div>
      }

      <!-- Actions -->
      <div class="flex flex-col xs:flex-row gap-3 sm:gap-4">
        <button
          type="submit"
          [disabled]="isSaving()"
          class="flex-1 px-4 sm:px-6 py-2.5 sm:py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors font-medium text-sm sm:text-base lg:text-lg min-h-[44px] flex items-center justify-center gap-2"
        >
          @if (isSaving()) {
            <span class="material-symbols-rounded text-lg sm:text-xl">save</span>
            <span>Guardando...</span>
          } @else {
            <span class="material-symbols-rounded text-lg sm:text-xl">{{
              isEditMode() ? 'save' : 'check'
            }}</span>
            <span class="hidden sm:inline">{{
              isEditMode() ? 'Actualizar Recordatorio' : 'Crear Recordatorio'
            }}</span>
            <span class="sm:hidden">{{ isEditMode() ? 'Actualizar' : 'Crear' }}</span>
          }
        </button>

        <button
          type="button"
          (click)="cancel()"
          [disabled]="isSaving()"
          class="px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 disabled:bg-gray-100 dark:disabled:bg-gray-700 transition-colors font-medium text-sm sm:text-base min-h-[44px]"
        >
          Cancelar
        </button>
      </div>
    </form>

    <!-- Help Text -->
    <div class="mt-6 sm:mt-8 p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
      <h3 class="text-sm font-medium text-blue-900 dark:text-blue-200 mb-2 flex items-center gap-1">
        <span class="material-symbols-rounded text-base sm:text-lg">lightbulb</span>
        <span>{{ 'form.tips' | translate }}</span>
      </h3>
      <ul class="text-xs sm:text-sm text-blue-800 dark:text-blue-200 space-y-1 list-disc list-inside pl-1">
        <li>{{ 'form.tip1' | translate }}</li>
        <li>{{ 'form.tip2' | translate }}</li>
        <li>{{ 'form.tip3' | translate }}</li>
        <li>{{ 'form.tip4' | translate }}</li>
      </ul>
    </div>
  </div>
</div>

<!-- Selector de ubicación con mapa -->
@if (showMapPicker()) {
  <app-location-picker
    [initialLatitude]="location()?.latitude"
    [initialLongitude]="location()?.longitude"
    (locationSelected)="onLocationSelected($event)"
    (locationCancel)="closeMapPicker()"
  ></app-location-picker>
}

<!-- Footer -->
<footer class="w-full bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 py-6">
  <div class="max-w-4xl mx-auto px-4">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-3 text-xs text-gray-600 dark:text-gray-400">
      <!-- Información -->
      <div class="flex items-center gap-2">
        <span class="font-semibold text-gray-700 dark:text-gray-300">© 2025 {{ 'list.title' | translate }}</span>
        <span class="text-gray-400 dark:text-gray-500">|</span>
        <span>{{ 'list.footerRights' | translate }}</span>
      </div>

      <!-- Links -->
      <div class="flex items-center gap-4">
        <span class="text-gray-600 dark:text-gray-400">{{ 'list.contact' | translate }}</span>
        <span class="text-gray-400 dark:text-gray-500">|</span>
        <a
          href="/privacy-policy"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
          >{{ 'list.privacy' | translate }}</a
        >
        <span class="text-gray-400 dark:text-gray-500">|</span>
        <a
          href="/terms-of-service"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
          >{{ 'list.terms' | translate }}</a
        >
      </div>
    </div>
  </div>
</footer>

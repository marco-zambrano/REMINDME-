<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <a
        routerLink="/reminders"
        class="text-blue-600 hover:text-blue-700 font-medium mb-4 inline-block"
      >
        <span class="material-symbols-rounded align-middle mr-1">arrow_back</span>
        Volver a la lista
      </a>
      <h1 class="text-3xl font-bold text-gray-900">
        <span class="material-symbols-rounded align-middle mr-2">{{ isEditMode() ? 'edit' : 'add' }}</span>
        {{ isEditMode() ? 'Editar Recordatorio' : 'Nuevo Recordatorio' }}
      </h1>
      <p class="text-gray-600 mt-2">
        {{
          isEditMode()
            ? 'Actualiza los detalles de tu recordatorio'
            : 'Crea un nuevo recordatorio con geolocalización'
        }}
      </p>
    </div>

    <!-- Form -->
    <form (ngSubmit)="save()" class="space-y-6">
      <!-- Título -->
      <div class="bg-white rounded-lg shadow p-6">
        <label for="title" class="block text-sm font-medium text-gray-700 mb-2"> Título * </label>
        <input
          type="text"
          id="title"
          [ngModel]="title()"
          name="title"
          (ngModelChange)="title.set($event)"
          required
          maxlength="100"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="Ej: Comprar leche"
        />
      </div>

      <!-- Descripción -->
      <div class="bg-white rounded-lg shadow p-6">
        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
          Descripción *
        </label>
        <textarea
          id="description"
          [ngModel]="description()"
          name="description"
          (ngModelChange)="description.set($event)"
          required
          rows="4"
          maxlength="500"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="Describe tu recordatorio..."
        ></textarea>
        <p class="text-xs text-gray-500 mt-1">{{ description().length }}/500 caracteres</p>
      </div>

      <!-- Categoría -->
      <div class="bg-white rounded-lg shadow p-6">
        <fieldset aria-labelledby="category-legend" class="border-0 p-0 m-0">
          <legend id="category-legend" class="block text-sm font-medium text-gray-700 mb-4">
            Categoría *
          </legend>
          <fieldset
            aria-labelledby="category-legend"
            class="grid grid-cols-2 md:grid-cols-4 gap-3 border-0 p-0 m-0"
          >
            @for (cat of categories(); track cat.slug) {
            <button
              type="button"
              (click)="updateCategory(cat.slug)"
              [class]="
                categorySlug() === cat.slug
                  ? (cat.color + ' text-white border-transparent')
                  : 'bg-white text-gray-800 border-gray-300 hover:border-gray-400'
              "
              class="flex items-center justify-center gap-2 p-4 border-2 rounded-lg transition-all cursor-pointer"
              title="Seleccionar {{ cat.name }}"
            >
              <span class="w-2 h-2 rounded-full" [class]="cat.color"></span>
              <span class="material-symbols-rounded text-2xl">{{ (cat.icon || 'label') | iconName }}</span>
              <span class="text-sm font-medium">{{ cat.name }}</span>
            </button>
            }
          </fieldset>
        </fieldset>
      </div>

      <!-- Ubicación -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="block text-sm font-medium text-gray-700 mb-4">Ubicación *</h3>

        @if (location()) {
        <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900 mb-1">
                <span class="material-symbols-rounded align-middle mr-1">location_on</span>
                {{ locationName() }}
              </p>
              <p class="text-xs text-gray-600">{{ locationAddress() }}</p>
              <p class="text-xs text-gray-500 mt-1">
                @if (location()) {
                  Lat: {{ location()!.latitude.toFixed(6) }}, Lng: {{ location()!.longitude.toFixed(6) }}
                }
              </p>
            </div>
            <button
              type="button"
              (click)="location.set(null)"
              class="text-red-600 hover:text-red-700 text-sm"
            >
              Cambiar
            </button>
          </div>
        </div>
        } @else {
        <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <p class="text-sm text-gray-700">
            No has seleccionado una ubicación. Por favor, elige una de las opciones:
          </p>
        </div>
        }

        <div class="flex gap-3">
          <button
            type="button"
            (click)="useCurrentLocation()"
            [disabled]="isLoadingLocation()"
            class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors font-medium"
          >
            @if (isLoadingLocation()) { 
              <span class="material-symbols-rounded align-middle mr-1">refresh</span>
              Obteniendo ubicación...
            } @else { 
              <span class="material-symbols-rounded align-middle mr-1">location_on</span>
              Usar ubicación actual 
            }
          </button>

          <button
            type="button"
            (click)="setManualLocation()"
            class="flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
          >
            <span class="material-symbols-rounded align-middle mr-1">keyboard</span>
            Ingresar coordenadas
          </button>
        </div>

        <!-- Nombre y dirección de la ubicación -->
        @if (location()) {
        <div class="mt-4 space-y-3">
          <div>
            <label for="locationName" class="block text-sm font-medium text-gray-700 mb-1">
              Nombre del lugar (opcional)
            </label>
            <input
              type="text"
              id="locationName"
              [ngModel]="locationName()"
              name="locationName"
              (ngModelChange)="locationName.set($event)"
              maxlength="100"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              placeholder="Ej: Supermercado del centro"
            />
          </div>
          <div>
            <label for="locationAddress" class="block text-sm font-medium text-gray-700 mb-1">
              Dirección (opcional)
            </label>
            <input
              type="text"
              id="locationAddress"
              [ngModel]="locationAddress()"
              name="locationAddress"
              (ngModelChange)="locationAddress.set($event)"
              maxlength="200"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
              placeholder="Ej: Calle Mayor 1, Madrid"
            />
          </div>
        </div>
        }
      </div>

      <!-- Radio de notificación -->
      <div class="bg-white rounded-lg shadow p-6">
        <label for="radius" class="block text-sm font-medium text-gray-700 mb-4">
          Radio de notificación: {{ radius() }}m
        </label>

        <div class="flex gap-2 mb-4">
          @for (opt of radiusOptions; track opt.value) {
          <button
            type="button"
            (click)="updateRadius(opt.value)"
            [class]="
              radius() === opt.value
                ? 'bg-blue-600 text-white'
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            "
            class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
          >
            {{ opt.label }}
          </button>
          }
        </div>

        <input
          type="range"
          id="radius"
          [ngModel]="radius()"
          name="radius"
          (ngModelChange)="radius.set($event)"
          min="50"
          max="5000"
          step="50"
          class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
        />

        <p class="text-xs text-gray-500 mt-2">
          Te notificaremos cuando estés a menos de {{ radius() }} metros del lugar.
        </p>
      </div>

      <!-- Actions -->
      <div class="flex gap-4">
        <button
          type="submit"
          [disabled]="isSaving()"
          class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors font-medium text-lg"
        >
          @if (isSaving()) {
            <span class="material-symbols-rounded align-middle mr-2">save</span>
            Guardando...
          } @else {
            <span class="material-symbols-rounded align-middle mr-2">{{ isEditMode() ? 'save' : 'check' }}</span>
            {{ isEditMode() ? 'Actualizar Recordatorio' : 'Crear Recordatorio' }}
          }
        </button>

        <button
          type="button"
          (click)="cancel()"
          [disabled]="isSaving()"
          class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:bg-gray-100 transition-colors font-medium"
        >
          Cancelar
        </button>
      </div>
    </form>

    <!-- Help Text -->
    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
      <h3 class="text-sm font-medium text-blue-900 mb-2">
        <span class="material-symbols-rounded align-middle mr-1">lightbulb</span>
        Consejos:
      </h3>
      <ul class="text-sm text-blue-800 space-y-1 list-disc list-inside">
        <li>Asegúrate de que tu navegador tenga permisos de ubicación activados</li>
        <li>Un radio de 500m es ideal para la mayoría de situaciones</li>
        <li>Puedes editar los recordatorios en cualquier momento desde la lista</li>
        <li>Las notificaciones solo funcionan cuando el monitoreo está activo</li>
      </ul>
    </div>
  </div>
</div>

<!-- Footer datos -->
<footer class="w-full bg-gray-50 border-t border-gray-200 py-6">
  <div class="max-w-4xl mx-auto px-4">
    <div class="flex flex-col sm:flex-row justify-between items-center gap-3 text-xs text-gray-600">
      <!-- Información -->
      <div class="flex items-center gap-2">
        <span class="font-semibold text-gray-700">© 2025 RemindMe</span>
        <span class="text-gray-400">|</span>
        <span>Todos los derechos reservados</span>
      </div>

      <!-- Links -->
      <div class="flex items-center gap-4">
        <span class="text-gray-600">Contacto: +593 98 765 4321</span>
        <span class="text-gray-400">|</span>
        <a href="/privacy-policy" class="hover:text-blue-600 transition-colors">Política de Privacidad</a>
        <span class="text-gray-400">|</span>
        <a href="/terms-of-service" class="hover:text-blue-600 transition-colors">Términos de Uso</a>
      </div>
    </div>
  </div>
</footer>

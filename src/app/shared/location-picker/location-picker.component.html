<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
    <!-- Header -->
    <div class="p-4 border-b border-gray-200">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
          <span class="material-symbols-rounded text-2xl">map</span>
          {{ 'location.title' | translate }}
        </h2>
        <button
          type="button"
          (click)="onCancel()"
          class="text-gray-500 hover:text-gray-700 p-2 rounded-full hover:bg-gray-100"
          [title]="'location.close' | translate"
        >
          <span class="material-symbols-rounded text-2xl">close</span>
        </button>
      </div>

      <!-- Barra de búsqueda -->
      <div class="relative">
        <span
          class="material-symbols-rounded absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
        >
          search
        </span>
        <input
          id="map-search-input"
          type="text"
          placeholder="Buscar lugar, dirección o coordenadas..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>
    </div>

    <!-- Mapa -->
    <div class="flex-1 relative">
      @if (isLoading()) {
        <div class="absolute inset-0 flex items-center justify-center bg-gray-100">
          <div class="text-center">
            <div
              class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"
            ></div>
            <p class="mt-4 text-gray-600">{{ 'location.loadingMap' | translate }}</p>
          </div>
        </div>
      }

      @if (errorMessage()) {
        <div class="absolute inset-0 flex items-center justify-center bg-red-50">
          <div class="text-center p-6">
            <span class="material-symbols-rounded text-6xl text-red-500 mb-4">error</span>
            <p class="text-red-700 font-medium">{{ errorMessage() }}</p>
          </div>
        </div>
      }

      <div id="google-map" class="w-full h-full min-h-[400px]"></div>

      <!-- Botón para centrar en ubicación actual -->
      <button
        type="button"
        (click)="centerOnCurrentLocation()"
        class="absolute bottom-4 right-4 bg-white p-3 rounded-full shadow-lg hover:bg-gray-100 transition-colors"
        title="Centrar en mi ubicación"
      >
        <span class="material-symbols-rounded text-blue-600">my_location</span>
      </button>
    </div>

    <!-- Footer con instrucciones y botones -->
    <div class="p-4 border-t border-gray-200 bg-gray-50">
      <div class="mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg">
        <p class="text-sm text-blue-800 flex items-start gap-2">
          <span class="material-symbols-rounded text-base mt-0.5 flex-shrink-0">info</span>
          <span>{{ 'location.info' | translate }}</span>
        </p>
      </div>

      <div class="flex gap-3">
        <button
          type="button"
          (click)="confirmLocation()"
          class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2"
        >
          <span class="material-symbols-rounded">check_circle</span>
          {{ 'location.confirm' | translate }}
        </button>
        <button
          type="button"
          (click)="onCancel()"
          class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium"
        >
          {{ 'location.cancel' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
